%===[ What is this? ]===========================================================

% κοινός • (koinós)
%  1. shared
%  2. common
%  3. public

% This module implements and aliases some commonplace macros.


\def\kDAppend#1#2%
{\edef\kDAct{\noexpand#2={\the#2\the#1}}\kDAct}



\newtoks\kDTmpTok
\newtoks\kDOptTok
\newtoks\kDGrpTok

\def\kDFetchTilGrpThen#1#2#{%
  \kDTmpTok={#2}
  \kDAppend\kDTmpTok\kDOptTok
  \kDFetchGrpThen{#1}}

\def\kDFetchGrpThen#1#2{%
  \def\kDExit{#1}
  \def\kDLoop{\kDFetchTilGrpThen{#1}}
  \kDTmpTok={{#2}}
  \kDIfNextHardCh;
    {\kDGrpTok\the\kDTmpTok\expandafter\kDExit\kDGobble}
    {\kDAppend\kDTmpTok\kDOptTok\kDLoop}}

\let\kDFetchOptAndGrpThen\kDFetchTilGrpThen





\bgroup
\def\:{\global\let\kDBlankSpace= }\:
\egroup

\long\def\kDIfNextSoftCh#1#2#3{%
\let\kDINCToken= #1% <- MEMO: this space is crucial
\def\kDINCTrue{#2}\def\kDINCFalse{#3}%
\futurelet\kDINCTok\kDINC%
}

\def\kDINC%
  {\ifx\kDINCTok\kDINCToken\let\kDINCFalse\kDINCTrue\fi\kDINCFalse}

\def\kDIdentity#1{#1}

\catcode`@=11

\let\kDIfNextHardCh\pgfutil@ifnextchar
\let\kDGobble\pgfutil@gobble

\catcode`@=12
