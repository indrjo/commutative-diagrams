% μανδύας • (mandýas)
%   1. cloak
%   2. mantle
%   3. dolman

% Mandias defines the aesthetics aspect of the user level functionality,
% together with some baseline configuration.

% TODO: clean these up
\usetikzlibrary[calc]
% \usetikzlibrary[decorations.pathreplacing]
% \usetikzlibrary{decorations.pathmorphing}
% \usetikzlibrary[decorations.markings]
% \usetikzlibrary[arrows.meta]

\pgfqkeys{/kD}{
%==[ universal styles ]=========================================================
  every diagram/.append style={},
  every layout/.append style={square},
  every object/.append style={},
  every arrow/.append style={
    >=stealth,
  },
  every label/.append style={
    auto,
    inner sep=0.5ex,
    font=\everymath\expandafter{\the\everymath\scriptstyle}
  },
%==[ arrow styles ]=============================================================
  /kD/arrows/.cd,
    crossing over/clearance/.initial=0.5ex,
    crossing over/color/.initial=white,
    crossing over/.style={
      /tikz/preaction={
        -,
        draw=\pgfkeysvalueof{/kD/arrows/crossing over/color},
        line width=\pgfkeysvalueof{/kD/arrows/crossing over/clearance},
      },
    },
    shove/.style={
      /tikz/transform canvas={
        /tikz/shift={($(\tikztostart)!#1!-90:(\tikztotarget)-(\tikztostart)$)}
      }
    },
    slide/.style={
      /tikz/transform canvas={
        /tikz/shift={($(\tikztostart)!#1!0:(\tikztotarget)-(\tikztostart)$)}
      }
    },
%==[ label styles ]=============================================================
  /kD/labels/.cd,
    mid/.style={
      /tikz/fill=white,
      /tikz/shape=circle,
      /tikz/anchor=center,
      /tikz/inner sep=.25ex
    },
%=[ objects styles ]============================================================
  /kD/objects/.cd,
    % TODO: reflect on these styles
    % rectangular/.style 2 args={
    %   /tikz/node distance=#2 and #1
    % },
    % square/.style={
    %   /kD/objects/rectangular={#1}{#1}
    % },
    % golden/.style={
    %   /kD/objects/rectangular={#1}{0.618*#1}
    % },
    % % comb/.style={
    % %   /kD/objects/rectangular={#1}{sqrt(3/4)*#1},
    % % },
    % % comb/.default=4em,
    % square/.default=4em,
    % golden/.default=4em,
%=[ lattice styles ]============================================================
  /kD/layouts/.cd,
    rectangular/.style 2 args={
      /tikz/column sep={#1,between origins},
      /tikz/row sep={#2,between origins},
    },
    square/.style={
      /kD/layouts/rectangular={#1}{#1}
    },
    golden/.style={
      /kD/layouts/rectangular={#1}{0.618*#1}
    },
    comb/.style args={base #1 angle #2}{
      /kD/layouts/rectangular={#1}{tan(#2)*#1*0.5},
      /tikz/every odd row/.append style={/tikz/xshift=#1*0.5}
    },
    comb/.default=base 4.5em angle 60,
    square/.default=4.5em,
    golden/.default=4.5em,
%=[ diagram styles ]============================================================
  /kD/diagrams/.cd,
    rectangular/.style 2 args={
      /kD/every layout/.append style={/kD/layouts/rectangular={#1}{#2}},
      % TODO: how much of the following is necessary in layouts?
      /tikz/on grid,
      /tikz/x=#1,
      /tikz/y=#2,
      /tikz/node distance=#1 and #2,
    },
    square/.style={
      /kD/every layout/.append style={/kD/layouts/square={#1}},
      /kD/diagrams/rectangular={#1}{#1},
    },
    golden/.style={
      /kD/every layout/.append style={/kD/layouts/golden={#1}},
      /kD/diagrams/rectangular={#1}{0.618*#1},
      /tikz/x={#1},
      /tikz/y={0.618*#1},
      /tikz/node distance=1 and 1,
      /tikz/on grid,
    },
    comb/.style={
      /kD/every layout/.append style={/kD/layouts/comb},
      /tikz/x={4.5em*0.5},
      /tikz/y={4.5em*tan(60)*0.5},
      /tikz/node distance=2,
      /tikz/on grid,
      /kD/diagrams/manhattan,
    },
    rectangular/.default={6em}{4em},
    square/.default=4.5em,
    golden/.default=4.5em,
    manhattan/.style={
      /tikz/above left/.code={\tikz@lib@place@handle@{##1}{south east}{-1}{1}{north west}{0.5}},
      /tikz/above right/.code={\tikz@lib@place@handle@{##1}{south west}{1}{1}{north east}{0.5}},
      /tikz/below left/.code={\tikz@lib@place@handle@{##1}{north east}{-1}{-1}{south west}{0.5}},
      /tikz/below right/.code={\tikz@lib@place@handle@{##1}{north west}{1}{-1}{south east}{0.5}}
    }
}
