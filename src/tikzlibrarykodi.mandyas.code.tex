% μανδύας • (mandýas)
%   1. cloak
%   2. mantle
%   3. dolman

% Mandias defines the aesthetics aspect of the user level functionality,
% together with some baseline configuration.

% TODO: clean these up
\usetikzlibrary[calc]
% \usetikzlibrary[decorations.pathreplacing]
% \usetikzlibrary{decorations.pathmorphing}
% \usetikzlibrary[decorations.markings]
% \usetikzlibrary[arrows.meta]

\pgfqkeys{/kD}{
%==[ universal styles ]=========================================================
  every layout/.append style={
    square
  },
  every object/.append style={},
  every arrow/.append style={},
  every label/.append style={
    auto,
    inner sep=0.5ex,
    font=\everymath\expandafter{\the\everymath\scriptstyle}
  },
%==[ arrow styles ]=============================================================
  /kD/arrows/.cd,
    crossing over/clearance/.initial=0.5ex,
    crossing over/color/.initial=white,
    crossing over/.style={
      /tikz/preaction={
        -,
        draw=\pgfkeysvalueof{/kD/arrows/crossing over/color},
        line width=\pgfkeysvalueof{/kD/arrows/crossing over/clearance},
      },
    },
    shove/.style={
      /tikz/transform canvas={
        /tikz/shift={($(\tikztostart)!#1!-90:(\tikztotarget)-(\tikztostart)$)}
      }
    },
    slide/.style={
      /tikz/transform canvas={
        /tikz/shift={($(\tikztostart)!#1!0:(\tikztotarget)-(\tikztostart)$)}
      }
    },
%==[ label styles ]=============================================================
  /kD/labels/.cd,
    mid/.style={
      /tikz/fill=white,
      /tikz/shape=circle,
      /tikz/anchor=center,
      /tikz/inner sep=.25ex
    },
%=[ objects styles ]============================================================
  /kD/objects/.cd,
    % TODO: reflect on these styles
    % rectangular/.style 2 args={
    %   /tikz/node distance=#2 and #1
    % },
    % square/.style={
    %   /kD/objects/rectangular={#1}{#1}
    % },
    % golden/.style={
    %   /kD/objects/rectangular={#1}{0.618*#1}
    % },
    % % comb/.style={
    % %   /kD/objects/rectangular={#1}{sqrt(3/4)*#1},
    % % },
    % % comb/.default=4em,
    % square/.default=4em,
    % golden/.default=4em,
%=[ lattice styles ]============================================================
  /kD/layouts/.cd,
    rectangular/.style 2 args={
      /tikz/column sep={#1,between origins},
      /tikz/row sep={#2,between origins},
      /tikz/node distance=#1 and #2
    },
    square/.style={
      /kD/layouts/rectangular={#1}{#1}
    },
    golden/.style={
      /kD/layouts/rectangular={#1}{0.618*#1}
    },
    comb/.style={
      /kD/layouts/rectangular={#1}{sqrt(3/4)*#1},
      /tikz/every odd row/.append style={/tikz/xshift=tan(30)*#1}
    },
    comb/.default=4em,
    square/.default=4em,
    golden/.default=4em
}
