% όζος • (ózos)
%   1. node
%   2. nodule
%   3. gnarl

% Ozos is an alternative parsing mechanism for TiKz nodes.
% It implements the following transformation
%   \kDOzos ... {CONTENTS};  --->  \node ... [node contents={CONTENTS}];
% to ensure the node contents always pass through the TikZ key.

\usetikzlibrary{kodi.koinos}

\pgfkeys{/ozos/every node/.style={}}

\def\kDOzos%
{\kDOzosFetchThen
{\kDOzosMaybeDumpThen
 \kDOzosOutput}}

\let\kDOzosFetchThen\kDFetchOptAndGrpThen

\def\kDOzosMaybeDumpThen#1{%
  \kDDump{options: '\the\kDOptTok'}%
  \kDDump{content: '\the\kDGrpTok'}%
  #1}

\def\kDOzosOutput{
  \edef\kDAct{
    \noexpand\node
      [/ozos/every node]
      \the\kDOptTok
      [/tikz/node contents={\the\kDGrpTok}];
  }
  \kDAct
}
